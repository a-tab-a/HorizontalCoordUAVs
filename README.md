# Collision Avoidance for Unmanned Aircraft using Coordination Tables

This directory contains the supplement code for the paper titled "Collision Avoidance for Unmanned Aircraft using Coordination Tables" by Rachael Tompa, Blake Wulfe, Michael Owen, and Mykel J. Kochenderfer, to appear in the 2016 Digital Avionics Systems Conference. 

<!-- MarkdownTOC -->

- [Overview](#overview)
    - [Dependencies](#dependencies)
    - [Layout](#layout)
- [Simulation Framework](#simulation-framework)
    - [Design](#design)
        - [Primary Components](#primary-components)
        - [Action Selection](#action-selection)
        - [Supporting types](#supporting-types)
    - [Tests](#tests)

<!-- /MarkdownTOC -->

## Overview
The code in this repository supports one of two tasks:

* generating and analyzing pairwise policies (src/pilot)
* evaluating those policies in simulation (src/simulation)

### Dependencies
The following Julia packages are required for running code. 
* [PGFPlots](https://github.com/sisl/PGFPlots.jl)
* [GridInterpolations](https://github.com/sisl/GridInterpolations.jl)
* [ODE](https://github.com/JuliaLang/ODE.jl)
* [Interact](https://github.com/JuliaLang/Interact.jl)
* [JLD](https://github.com/JuliaLang/JLD.jl)
* [DiscreteMDPs](https://github.com/sisl/DiscreteMDPs.jl)
* [PyPlot](https://github.com/stevengj/PyPlot.jl)
* [TikzPictures](https://github.com/sisl/TikzPictures.jl)

### Layout
```
src/

    dvi/
        DiscreteValueIteration.jl
        helpers.jl
        parallel.jl
        policy.jl

    pilot/
        PilotSCA.jl
        PilotSCAConst.jl
        PilotSCAs.jl
        README.md

    simulation/
        analyze_encounters.jl
        build_simulation.jl
        dynamics.jl
        encounter.jl
        environment.jl
        run_simulation.jl
        state.jl
        strategies.jl
        tables.jl
        uav.jl

data/
    qvalue_tables/
    plots/

README.md
```

## Simulation Framework
This section describes the implementation of the simulation framework. For example usage for most functions, please refer to the tests/test_simulation directory. 

### Design

#### Primary Components
The bulk of the framework existing the following four files:

1. An Environment type is an environment in which encounters occur and acts as a wrapper around the other types (environment.jl). Encounters are generated by the environment.
2. An Environment contains a list of UAVs (the code currently supports two uavs), these are the agents that make decisions on how to act using policy and coordination tables (uav.jl).
3. An Environment also contains a Dynamics type, which is responsible to stepping the state of the system forward in time (dynamics.jl).
4. All of the information need for uavs to make decisions (2) and the dynamics to step the state (3) is contained in a State type (state.jl).

#### Action Selection
The UAV type delegates to other types / functions in order to choose actions and generate signals

1. Each uav has a policy and coordination table that it uses to make decisions (tables.jl).
2. Each uav delegates to some "strategy" function to choose actions and signals. The two options are a "greedy" and "coordinated" strategy (strategies.jl).

#### Supporting types
There are three additional supporting files:

1. build_simulation.jl contains code for building a default environment. This is used with the batch simulation code to run simulations with different settings concurrently.
2. run_simulation.jl contains the code to actually run the simulations. See simulate_encounter for the main simulation loop. To change the number of encounters to simulate, see the function run_simulation().
3. analyze_encounters.jl contains code for printing plots of the paths and actions for the uavs, for stepping through encounters, and for printing out aggregate statistics about the simulated encounters. 
4. encounter.jl contains a type that is used to accumulate information about encounters.

### Tests
Much of the simulation framework has tests associated with it in tests/test_simulation. To run all of the tests in this directory, enter the following in terminal:
```
julia run_tests.jl
```
This code will display a few plots by default, which you'll need to exit to continue with testing. This can be disabled by changing SHOW_PLOTS to false in test_simulation/includes.jl.
